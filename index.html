<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Login - Pro Stevenewton</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <!-- MDB icon -->
  <link rel="icon" href="img/mdb-favicon.ico" type="image/x-icon" />
  <!-- Font Awesome -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
  />
<!-- MDB core CSS -->
<link rel="stylesheet" href="css/mdb.min.css" />
<!-- Custom styles -->
<link rel="stylesheet" href="css/admin.css" />

  <style>
    body {
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      min-height: 100vh;
    }
    .login-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .login-card {
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .tab-content {
      padding: 0;
    }
    .nav-tabs {
      border-bottom: none;
      margin-bottom: 20px;
    }
    .nav-tabs .nav-link {
      border: none;
      color: #6c757d;
      font-weight: 500;
    }
    .nav-tabs .nav-link.active {
      background: none;
      color: #1e3c72;
      border-bottom: 2px solid #1e3c72;
    }
    .btn-primary {
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      border: none;
    }
    .btn-primary:hover {
      background: linear-gradient(135deg, #1a3463 0%, #245289 100%);
    }
  </style>
</head>
<body>
  <div class="login-container">
    <div class="card login-card shadow-lg" style="max-width: 450px; width: 100%; border-radius: 15px;">
      <div class="card-body p-5">
        <div class="text-center mb-4">
          <h4 class="fw-bold">pro.sn</h4>
          <p class="text-muted">Secure Access Portal</p>
        </div>
        
        <!-- Tabs -->
        <ul class="nav nav-tabs nav-justified mb-4" id="authTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="login-tab" data-mdb-tab-init data-mdb-target="#login" type="button" role="tab" aria-controls="login" aria-selected="true">
              Sign In
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="register-tab" data-mdb-tab-init data-mdb-target="#register" type="button" role="tab" aria-controls="register" aria-selected="false">
              Sign Up
            </button>
          </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="authTabsContent">
          <!-- Login Tab -->
          <div class="tab-pane fade show active" id="login" role="tabpanel" aria-labelledby="login-tab">
            <form id="loginForm">
              <!-- Email input -->
              <div class="form-outline mb-4">
                <input type="email" id="loginEmail" class="form-control" required />
                <label class="form-label" for="loginEmail">Email</label>
              </div>

              <!-- Password input -->
              <div class="form-outline mb-4">
                <input type="password" id="loginPassword" class="form-control" required />
                <label class="form-label" for="loginPassword">Password</label>
              </div>

              <!-- Submit button -->
              <button type="submit" class="btn btn-primary btn-block mb-3" id="loginBtn">
                <span class="login-text">Sign in</span>
                <span class="login-spinner d-none">
                  <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                  Signing in...
                </span>
              </button>
            </form>
          </div>

          <!-- Register Tab -->
          <div class="tab-pane fade" id="register" role="tabpanel" aria-labelledby="register-tab">
            <form id="registerForm">
              <!-- Email input -->
              <div class="form-outline mb-4">
                <input type="email" id="registerEmail" class="form-control" required />
                <label class="form-label" for="registerEmail">Email</label>
              </div>

              <!-- Password input -->
              <div class="form-outline mb-4">
                <input type="password" id="registerPassword" class="form-control" required minlength="6" />
                <label class="form-label" for="registerPassword">Password</label>
                <div class="form-text">Must be at least 6 characters long</div>
              </div>

              <!-- Confirm Password input -->
              <div class="form-outline mb-4">
                <input type="password" id="confirmPassword" class="form-control" required />
                <label class="form-label" for="confirmPassword">Confirm Password</label>
              </div>

              <!-- Submit button -->
              <button type="submit" class="btn btn-primary btn-block mb-3" id="registerBtn">
                <span class="register-text">Create Account</span>
                <span class="register-spinner d-none">
                  <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                  Creating...
                </span>
              </button>
            </form>
          </div>
        </div>

        <!-- Alert messages -->
        <div id="alertContainer"></div>
      </div>
    </div>
  </div>

  <!-- MDB JS -->
  <script type="text/javascript" src="js/mdb.umd.min.js"></script>
  
  <!-- Firebase JS -->
  <script type="module">
    // Import Firebase functions
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { 
      getAuth, 
      signInWithEmailAndPassword, 
      createUserWithEmailAndPassword,
      onAuthStateChanged,
      sendEmailVerification
    } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

    // Your Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBddP6AW0CG6xyJ4r7_4q_ZZ_6mnH0kjsE",
      authDomain: "prosnme.firebaseapp.com",
      projectId: "prosnme",
      storageBucket: "prosnme.firebasestorage.app",
      messagingSenderId: "1043834100115",
      appId: "1:1043834100115:web:b760f6968c7998a0a3b066"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // Check if user is already logged in
    onAuthStateChanged(auth, (user) => {
      if (user) {
        // User is signed in, redirect to admin
        window.location.href = 'admin.html';
      }
    });

    // Utility functions
    function showAlert(message, type = 'danger') {
      const alertContainer = document.getElementById('alertContainer');
      const alert = document.createElement('div');
      alert.className = `alert alert-${type} alert-dismissible fade show`;
      alert.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-mdb-dismiss="alert"></button>
      `;
      alertContainer.innerHTML = '';
      alertContainer.appendChild(alert);
      
      // Auto-hide after 5 seconds
      setTimeout(() => {
        alert.remove();
      }, 5000);
    }

    function showLoading(formType, isLoading) {
      const btn = document.getElementById(`${formType}Btn`);
      const textSpan = btn.querySelector(`.${formType}-text`);
      const spinnerSpan = btn.querySelector(`.${formType}-spinner`);
      
      if (isLoading) {
        textSpan.classList.add('d-none');
        spinnerSpan.classList.remove('d-none');
        btn.disabled = true;
      } else {
        textSpan.classList.remove('d-none');
        spinnerSpan.classList.add('d-none');
        btn.disabled = false;
      }
    }

    // Login form handler
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      showLoading('login', true);

      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value.trim();

      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        
        showAlert('Login successful! Redirecting...', 'success');
        
        // Redirect after short delay
        setTimeout(() => {
          window.location.href = 'admin.html';
        }, 1500);
        
      } catch (error) {
        let errorMessage = 'Login failed';
        
        switch (error.code) {
          case 'auth/user-not-found':
            errorMessage = 'No account found with this email';
            break;
          case 'auth/wrong-password':
            errorMessage = 'Incorrect password';
            break;
          case 'auth/invalid-email':
            errorMessage = 'Invalid email address';
            break;
          case 'auth/user-disabled':
            errorMessage = 'Account has been disabled';
            break;
          case 'auth/too-many-requests':
            errorMessage = 'Too many failed attempts. Try again later';
            break;
          default:
            errorMessage = error.message;
        }
        
        showAlert(errorMessage);
      } finally {
        showLoading('login', false);
      }
    });

    // Register form handler
    document.getElementById('registerForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      showLoading('register', true);

      const email = document.getElementById('registerEmail').value.trim();
      const password = document.getElementById('registerPassword').value.trim();
      const confirmPassword = document.getElementById('confirmPassword').value.trim();

      // Client-side validation
      if (password !== confirmPassword) {
        showAlert('Passwords do not match');
        showLoading('register', false);
        return;
      }

      if (password.length < 6) {
        showAlert('Password must be at least 6 characters long');
        showLoading('register', false);
        return;
      }

      try {
        // Create user
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;

        // Send verification email
        await sendEmailVerification(user);

        showAlert('Welcome! Check your email to verify your account for full security.', 'info');
        
        // Redirect after short delay
        setTimeout(() => {
          window.location.href = 'admin.html';
        }, 1500);
        
      } catch (error) {
        let errorMessage = 'Registration failed';
        
        switch (error.code) {
          case 'auth/email-already-in-use':
            errorMessage = 'An account with this email already exists';
            break;
          case 'auth/invalid-email':
            errorMessage = 'Invalid email address';
            break;
          case 'auth/weak-password':
            errorMessage = 'Password is too weak';
            break;
          default:
            errorMessage = error.message;
        }
        
        showAlert(errorMessage);
      } finally {
        showLoading('register', false);
      }
    });

    // Password confirmation validation
    document.getElementById('confirmPassword').addEventListener('input', function() {
      const password = document.getElementById('registerPassword').value;
      const confirmPassword = this.value;
      
      if (confirmPassword && password !== confirmPassword) {
        this.classList.add('is-invalid');
      } else {
        this.classList.remove('is-invalid');
      }
    });
  </script>
</body>
</html>